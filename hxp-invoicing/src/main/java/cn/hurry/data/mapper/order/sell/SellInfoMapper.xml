<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.hurry.data.mapper.order.sell.SellInfoMapper">

	<resultMap id="SellInfoResultMap" type="SellInfo">
		<id property="id" column="id" />
		<result property="sellOrderId" column="sellOrderId"/>
		<result property="buyOrderId" column="buyOrderId"/>
		<result property="buyOrderGoodsId" column="buyOrderGoodsId"/>
		<result property="sellOrderGoodsId" column="sellOrderGoodsId"/>
		<collection property="sellOrder" column="sellOrderId" ofType="SellOrder" select="cn.hurry.data.mapper.order.sell.SellOrderMapper.selectSellOrderById"></collection>
		<collection property="buyOrder" column="buyOrderId" ofType="BuyOrder" select="cn.hurry.data.mapper.order.buy.BuyOrderMapper.selectBuyOrderById"></collection>
		<collection property="sellOrderGoods" column="sellOrderGoodsId" ofType="SellOrderGoods" select="cn.hurry.data.mapper.order.sell.SellOrderGoodsMapper.selectSellOrderGoodsById"></collection>
		<collection property="buyOrderGoods" column="buyOrderGoodsId" ofType="BuyOrderGoods" select="cn.hurry.data.mapper.order.buy.BuyOrderGoodsMapper.selectBuyOrderGoodsById"></collection>
	</resultMap>

	<sql id="selectWhere">
		<if test="sellOrderId != null">
			AND sell_info.sellOrderId=#{sellOrderId}
		</if>
		<if test="buyOrderId != null">
			AND sell_info.buyOrderId=#{buyOrderId}
		</if>
		<if test="buyOrderGoodsId != null">
			AND sell_info.buyOrderGoodsId=#{buyOrderGoodsId}
		</if>
		<if test="sellOrderGoodsId != null">
			AND sell_info.sellOrderGoodsId=#{sellOrderGoodsId}
		</if>
		<if test="goodsId != null">
			AND buy_order_goods.goodsId=#{goodsId}
		</if>
		<if test="buyCreateDateStart!=null">
			AND  buy_order.createDate &gt;=#{buyCreateDateStart}
		</if>
		<if test="buyCreateDateEnd!=null">
			AND  buy_order.createDate &lt;=#{buyCreateDateEnd}
		</if>
		<if test="sellCreateDateStart!=null">
			AND  sell_order.createDate &gt;=#{sellCreateDateStart}
		</if>
		<if test="sellCreateDateEnd!=null">
			AND  sell_order.createDate &lt;=#{sellCreateDateEnd}
		</if>
		
	</sql>

	<insert id="insertSellInfo" parameterType="SellInfo">
		INSERT INTO `sell_info` 
		(sellOrderId,buyOrderId,buyOrderGoodsId,sellOrderGoodsId,number,surplusNumber,remark)
		VALUES
		(#{sellOrderId},#{buyOrderId},#{buyOrderGoodsId},#{sellOrderGoodsId},#{number},#{surplusNumber},#{remark})
	</insert>

	<select id="selectSellInfoById" parameterType="int" resultMap="SellInfoResultMap">
		SELECT * FROM `sell_info` WHERE id = #{id}
	</select>

	<select id="selectSellInfoByMap" parameterType="map" resultMap="SellInfoResultMap">
		SELECT sell_info.* FROM sell_info
		LEFT JOIN buy_order_goods ON buy_order_goods.`id`=sell_info.`buyOrderGoodsId`
		LEFT JOIN buy_order ON sell_info.buyOrderId=buy_order.id
		LEFT JOIN sell_order ON sell_info.sellOrderId=sell_order.id
		<where>
			<include refid="selectWhere"/>
		</where>
		ORDER BY id
	</select>
	
	<select id="countSellInfoByMap" parameterType="map" resultMap="SellInfoResultMap">
		SELECT count(sell_info.id) FROM `sell_info`
		LEFT JOIN buy_order_goods ON buy_order_goods.`id`=sell_info.`buyOrderGoodsId`
		LEFT JOIN buy_order ON sell_info.buyOrderId=buy_order.id
		LEFT JOIN sell_order ON sell_info.sellOrderId=sell_order.id
		<where>
			<include refid="selectWhere"/>
		</where>
	</select>
	
</mapper> 
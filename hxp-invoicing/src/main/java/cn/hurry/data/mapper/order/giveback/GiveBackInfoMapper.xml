<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.hurry.data.mapper.order.giveback.GiveBackInfoMapper">

	<resultMap id="GiveBackInfoResultMap" type="GiveBackInfo">
		<id property="id" column="id" />
		<result property="storeId" column="storeId"/>
		<collection property="createUser" column="createUserId" ofType="User" select="cn.hurry.data.mapper.user.UserMapper.selectUserById"></collection>
		<collection property="sellOrderGoods" column="sellOrderGoodsId" ofType="SellOrderGoods" select="cn.hurry.data.mapper.order.sell.SellOrderGoodsMapper.selectSellOrderGoodsById"></collection>
	</resultMap>

	<sql id="selectWhere">
		<if test="orderId != null">
			AND `sell_order_goods`.orderId=#{orderId}
		</if>
		<if test="goodsId != null">
			AND `sell_order_goods`.goodsId=#{goodsId}
		</if>
		<if test="backTime != null">
			AND `give_back_info`.backTime=#{backTime}
		</if>
		<if test="backTimeLT != null">
			AND `give_back_info`.backTime &lt;=#{backTimeLT}
		</if>
		<if test="backTimeGT != null">
			AND `give_back_info`.backTime &gt;=#{backTimeGT}
		</if>
		<if test="createUserId != null">
			AND `give_back_info`.createUserId =#{createUserId}
		</if>
		<if test="remark != null">
			AND `give_back_info`.remark = #{remark}
		</if>
	</sql>
	
	<insert id="insertGiveBackInfo" parameterType="GiveBackInfo">
		INSERT INTO `give_back_info` 
		(id,sellOrderGoodsId,number,backTime,createUserId,remark)
		VALUES
		(#{id},#{sellOrderGoodsId},#{number},#{backTime},#{createUserId},#{remark})
	</insert>

	<update id="updateGiveBackInfo" parameterType="GiveBackInfo">
		UPDATE `give_back_info` SET number=#{number} WHERE id=#{id}
	</update>

	<delete id="deleteGiveBackInfo" parameterType="GiveBackInfo">
		DELETE FROM `give_back_info` WHERE id = #{id}
	</delete>

	<select id="selectGiveBackInfoById" parameterType="int" resultMap="GiveBackInfoResultMap">
		SELECT * FROM `give_back_info` WHERE id = #{id}
	</select>

	<select id="selectGiveBackInfoByMap" parameterType="map" resultMap="GiveBackInfoResultMap">
		SELECT `give_back_info`.* FROM `give_back_info`
		LEFT JOIN sell_order_goods ON `give_back_info`.SellOrderGoodsId=sell_order_goods.id
		<where>
			<include refid="selectWhere"/>
		</where>
		<if test="sortField!=null and sortField!=''">
			ORDER BY ${sortField} ${sortOrder}
		</if>
		<if test="sortField==null or sortField==''">
			ORDER BY `give_back_info`.backTime DESC
		</if>
		<if test="firstResult != null">
			<if test="maxResults != null">
				LIMIT ${firstResult},${maxResults}
			</if>
		</if>
		
	</select>
	
	<select id="countGiveBackInfoByMap" parameterType="map" resultType="int">
		SELECT count(`give_back_info`.id) FROM `give_back_info`
		LEFT JOIN sell_order_goods ON `give_back_info`.SellOrderGoodsId=sell_order_goods.id
		<where>
			<include refid="selectWhere"/>
		</where>
	</select>
	
</mapper> 